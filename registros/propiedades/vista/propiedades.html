<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>
	<title></title>
	<script type="text/javascript" src="/kalilhel/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="/kalilhel/js/jquery.form.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			$("#areaRegCaracteriticas").css('visibility', 'hidden');

			var options = { 
			    beforeSend: function() 
			    {
			        $("#progress").show();
			        //clear everything
			        $("#bar").width('0%');
			        $("#message").html("");
			        $("#percent").html("0%");
			    },
			    uploadProgress: function(event, position, total, percentComplete) 
			    {
			        $("#bar").width(percentComplete+'%');
			        $("#percent").html(percentComplete+'%');
			 
			    },
			    success: function() 
			    {
			        $("#bar").width('100%');
			        $("#percent").html('100%');
			 
			    },
			    complete: function(response) 
			    {
			        $("#message").html("<font color='green'>"+response.responseText+"</font>");
			        $clave_propiedad = $("#claveNombreFile").val();
			        $tipo_documento = $("#tipoDocumentoFile").val();
			        $archivo = $("#myfile").val();
			        $descripcion = $("#descripcionFile").val();
			        $cadena = $clave_propiedad+"///"+$tipo_documento+"///"+$archivo+"///"+$descripcion+"///";
			        $explode= $archivo.split(".");
					$extension=$explode.pop();
					$nombre_archivo = $tipo_documento+"_"+$clave_propiedad+"."+$extension;
			        almacenaArchivos($cadena);
			        $('#listadoArchivos tr:last').after('<tr><td>'+$tipo_documento+'</td><td>'+$descripcion+'</td><td><a href="../../../uploads/propiedades/'+$nombre_archivo+'" target="_BLANK">Abrir Archivo</a></td></tr>');
			    },
			    error: function()
			    {
			        $("#message").html("<font color='red'> ERROR: unable to upload files</font>");
			 
			    }
			}; 
			$("#myForm").ajaxForm(options);
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "cargaListadoPropiedad" },
	 			success: function(data){
	 				obj = JSON.parse(data);
	 				$v1=0;
	 				while(obj.Propiedad[$v1]){
	 					agregaFilaPropiedades(obj.Propiedad[$v1]);
						$v1++;
	 				}
	 			}
	 		});
	 		caracteristicas();
	 		$("#btnAgregaCaract").click(function(){
	 			
	 			$clavePropiedad = $("#txtPropiedadesClave").val();
	 			$valueCaract = $("#slcPropiedadesCaracteristicas").val();
	 			$textCaract = $("#slcPropiedadesCaracteristicas option:selected").text();
	 			$valorCaract = $("#txtPropiedadesCaracteristicaValor").val();

	 			$campos = $clavePropiedad+"@"+$valueCaract+"@"+$valorCaract;

	 			$.ajax({
		 			type: "POST",
		 			url: "../control/control.php",
		 			data: { "funcion" :  "agregaCaracteristica","valores": $campos },
		 			success: function(data){
		 				$('#listadoCaracteristicas tr:last').after("<tr><td>"+$textCaract+"</td><td>"+$valorCaract+"</td></tr>");
		 			}
	 			});

	 		});
	 		$("#listadoPropiedades").on('click','td',function(){
				$("#listadoPropiedades td").css('background-color','#ffffff');
				$(this).parent('tr').children('td').css('background-color','#e8f5bf');
			});
		});
		function agregaFilaPropiedades(reg){
		$('#listadoPropiedades tr:last').after('<tr onclick="muestraPropiedad('+reg.clave+'); muestraArchivos('+reg.clave+')"><td>'+reg.clave+'</td><td>'+reg.nombre+'</td><td></td><td>'+reg.monto_inquilino+'</td></tr>');
		}
		function muestraPropiedad(clave){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "recuperaUnaPropiedad", "clave": clave },
	 			success: function(data){
	 				$("#listadoCaracteristicas").html("<tr><td>Caracteristica</td><td>Valor</td></tr>");
	 				
	 				cargaCaracteristicas(clave);
	 				obj = JSON.parse(data);
	 				$("#claveNombreFile").val(obj.Propiedad[0].clave);
	 				$("#txtPropiedadesClave").val(obj.Propiedad[0].clave);
	 				$("#txtPropiedadesNombre").val(obj.Propiedad[0].nombre);
	 				$("#txtPropiedadesMontoInquilino").val(obj.Propiedad[0].monto_inquilino);
	 				$("#areaRegCaracteriticas").css('visibility', 'visible');
	 			}
	 		});
		}
		function caracteristicas(){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "listaCaracteristicas" },
	 			success: function(data){
	 				$("#slcPropiedadesCaracteristicas").append(data);
	 			}
	 		});
		}
		function cargaCaracteristicas(clave){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "buscaCaracteristicas", "clavePropiedad": clave},
	 			success: function(data){
	 				$('#listadoCaracteristicas tr:last').after(data);
	 			}
	 		});
		}
		function almacenaArchivos($cadena){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" : "almacenaArchivos", "cadena": $cadena },
	 			success: function(data){
	 				alert(data);
	 			}
	 		});
		}
		function muestraArchivos(clave){
				// alert("muestra");
				$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "muestraArchivos", "clave": clave },
	 			success: function(data){

	 				$('#listadoArchivos tr:last').after(data);
	 				
	 			}
	 		});
		}
	 </script>
	 <style>
		form { display: block; margin: 20px auto; background: #eee; border-radius: 10px; padding: 15px }
		#progress { position:relative; width:400px; border: 1px solid #ddd; padding: 1px; border-radius: 3px; }
		#bar { background-color: #B4F5B4; width:0%; height:20px; border-radius: 3px; }
		#percent { position:absolute; display:inline-block; top:3px; left:48%; }
	</style>
</head>
<body>
<br>
<h1>Propiedades</h1>
<table border="1" id="listadoPropiedades">
	<tr>
		<th>Clave</th><th>Propiedad</th><th>Propietario</th><th>Monto Generado</th>
	</tr>
</table>
<br><br>
Clave: <input type="text" id="txtPropiedadesClave"> <br>
Nombre Propiedad <input type="text" id="txtPropiedadesNombre"> <br>
Tipo Propiedad <select id="slcPropiedadesTipo"><option>opc1</option></select><br>
Propietario <select id="slcPropiedadesPropietario"><option>opc1</option></select><br>
Paga Mantenimiento <select id="slcPropiedadesMantenimiento"><option>SI</option><option>NO</option></select><br>
Direccion: <input type="text" id="txtPropiedadesDireccion"> 
Numero Ext: <input type="text" id="txtPropiedadesNE"> Int: <input type="text" id="txtPropiedadesNI"> <br>
CP<input type="text" id="txtPropiedadesCP"> <br>
Ciudad<input type="text" id="txtPropiedadesCiudad"> <br>
Estado<input type="text" id="txtPropiedadesEstado"> <br>
Valor Generado Inicial $<input type="text" id="txtPropiedadesValorInicial"> <br>
Tipo de Moneda <input type="text" id="txtPropiedadesMoneda"> <br>
Valor Tipo Cambio: <input type="text" id="txtPropiedadesCambio"> <br>
Fecha Adquisición: <input type="text" id="txtPropiedadesAdquisicion"> <br>
Valor Real Actual: <input type="text" id="txtPropiedadesValorActual"> <br>
Monto Generado por Inquilino Actual: <input type="text" id="txtPropiedadesMontoInquilino"> <br>

<div id="areaRegCaracteriticas">
	<h3>Registro de Caracteristicas</h3>

	Caracteristica: <select id="slcPropiedadesCaracteristicas"><option>Seleccione una Caracteristica</option></select>    Valor:<input type="text" id="txtPropiedadesCaracteristicaValor"> <br>
	<input type="button" value="Agregar" id="btnAgregaCaract">
	<br>
	<table id="listadoCaracteristicas" border="1">
		<tr>
			<td>Caracteristica</td><td>Valor</td>
		</tr>
	</table>
</div>
<form id="myForm" action="../../../archivos/control/upload.php" method="post" enctype="multipart/form-data">
	
	<select id="tipoDocumentoFile" name="tipoDocumentoFile"><option value="doc1">Documento 1</option><option value="doc2">Documento 2</option></select>
	<br><br>
	<input type="file" size="60" name="myfile" id="myfile">
	<br><br>
	Descripción:<br> <textarea id="descripcionFile"></textarea>
	<br><br>
	<input type="submit" value="Cargar Archivo">
	
	<input type="hidden" value="0" name="claveNombreFile" id="claveNombreFile">
	<input type="hidden" value="propiedades" name="subdir">
	
 </form>
 
 <br>
  <div id="progress">
        <div id="bar"></div>
        <div id="percent">0%</div >
</div>
<br/>
 
<div id="message"></div>
 <br>
<table border="1" id="listadoArchivos">
	<tr>
		<td>Tipo Documento</td><td>Descripción</td>
	</tr>
</table>
</body>
</html>