<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head> 
	<title></title>
	<!-- <link href="../../../css/bootstrap-combined.no-icons.min.css" rel="stylesheet"> -->
	<link href="../../../css/font-awesome.css" rel="stylesheet"> 
	<link rel="stylesheet" type="text/css" href="../../../css/general.css">
	<link rel="stylesheet" type="text/css" href="../../../tabla.css">
	<script type="text/javascript" src="/kalilhel/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="/kalilhel/js/jquery.form.js"></script>
	<script type="text/javascript">
			$(document).ready(function(){
			$("#submenu .subli").width((anchoVentana()/cuentaMenus())-1);
			$(window).resize(function(){
				$("#submenu .subli").width((anchoVentana()/cuentaMenus())-cuentaMenus());
			});
			$("#areaArchivos").hide();
			$("#areaFormulario").hide();
			$("#areaRegCaracteriticas").hide();
			

			var options = { 
			    beforeSend: function() 
			    {
			        $("#progress").show();
			        //clear everything
			        $("#bar").width('0%');
			        $("#message").html("");
			        $("#percent").html("0%");
			    },
			    uploadProgress: function(event, position, total, percentComplete) 
			    {
			        $("#bar").width(percentComplete+'%');
			        $("#percent").html(percentComplete+'%');
			 
			    },
			    success: function() 
			    {
			        $("#bar").width('100%');
			        $("#percent").html('100%');
			 
			    },
			    complete: function(response) 
			    {
			        $("#message").html("<font color='green'>"+response.responseText+"</font>");
			        $clave_propiedad = $("#claveNombreFile").val();
			        $tipo_documento = $("#tipoDocumentoFile").val();
			        $archivo = $("#myfile").val();
			        $descripcion = $("#descripcionFile").val();
			        $cadena = $clave_propiedad+"///"+$tipo_documento+"///"+$archivo+"///"+$descripcion+"///";
			        $explode= $archivo.split(".");
					$extension=$explode.pop();
					$nombre_archivo = $tipo_documento+"_"+$clave_propiedad+"."+$extension;
			        almacenaArchivos($cadena);
			        $("#listadoArchivos #tr"+$tipo_documento).remove();
			        $('#listadoArchivos tr:last').after('<tr id="tr'+$tipo_documento+'"><td>'+$tipo_documento+'</td><td>'+$descripcion+'</td><td><a href="../../../uploads/propiedades/'+$nombre_archivo+'" target="_BLANK">Abrir Archivo</a></td></tr>');
			        $("#myfile").val('');
			        $("#descripcionFile").val('');
			    },
			    error: function()
			    {
			        $("#message").html("<font color='red'> ERROR: unable to upload files</font>");
			 
			    }
			}; 
			$("#myForm").ajaxForm(options);

			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "cargaListadoPropiedad" },
	 			success: function(data){
	 				obj = JSON.parse(data);
	 				$v1=0;
	 				while(obj.Propiedad[$v1]){
	 					agregaFilaPropiedades(obj.Propiedad[$v1]);
						$v1++;
	 				}
	 			}
	 		});

	 		$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "cargaTipoPropiedad" },
	 			success: function(data){
	 				$("#slcPropiedadesTipo").append(data);
	 			}
	 		});

	 		$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "cargaPropietario" },
	 			success: function(data){
	 				// alert(data);
	 				$("#slcPropiedadesPropietario").append(data);
	 			}
	 		});

	 		$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "cargaEstados" },
	 			success: function(data){
	 				// alert(data);
	 				$("#txtPropiedadesEstado").append(data);
	 			}
	 		});
	 		
	 		
	 		caracteristicas();
	 		$("#btnAgregaCaract").click(function(){
	 			
	 			$clavePropiedad = $("#txtPropiedadesClave").val();
	 			$valueCaract = $("#slcPropiedadesCaracteristicas").val();
	 			$textCaract = $("#slcPropiedadesCaracteristicas option:selected").text();
	 			$valorCaract = $("#txtPropiedadesCaracteristicaValor").val();

	 			$campos = $clavePropiedad+"@"+$valueCaract+"@"+$valorCaract;

	 			$.ajax({
		 			type: "POST",
		 			url: "../control/control.php",
		 			data: { "funcion" :  "agregaCaracteristica","valores": $campos },
		 			success: function(data){
		 				$('#listadoCaracteristicas tr:last').after("<tr><td>"+$textCaract+"</td><td>"+$valorCaract+"</td></tr>");
		 			}
	 			});

	 		});
	 		$("#listadoPropiedades").on('click','td',function(){
				$("#listadoPropiedades td").css('background-color','#ffffff');
				$(this).parent('tr').children('td').css('background-color','#e8f5bf');
			});
		});
		function agregaFilaPropiedades(reg){
		$('#listadoPropiedades tr:last').after('<tr onclick="muestraPropiedad('+reg.clave+'); muestraArchivos('+reg.clave+')"><td>'+reg.clave+'</td><td>'+reg.nombre+'</td><td></td><td>'+reg.monto_inquilino+'</td></tr>');
		}
		function muestraPropiedad(clave){
			menuDos();
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "recuperaUnaPropiedad", "clave": clave },
	 			success: function(data){
	 				$("#listadoCaracteristicas").html("<tr><td>Caracteristica</td><td>Valor</td></tr>");
	 				
	 				cargaCaracteristicas(clave);
	 				obj = JSON.parse(data);
	 				$("#claveNombreFile").val(obj.Propiedad[0].clave);
	 				$("#txtPropiedadesClave").val(obj.Propiedad[0].clave);
	 				$("#txtPropiedadesNombre").val(obj.Propiedad[0].nombre);
	 				$("#txtPropiedadesMontoInquilino").val(obj.Propiedad[0].monto_inquilino);
	 				$("#slcPropiedadesTipo").val(obj.Propiedad[0].tipo_propiedad);
					$("#slcPropiedadesPropietario").val(obj.Propiedad[0].propietario);
					$("#slcPropiedadesMantenimiento").val(obj.Propiedad[0].paga_mantenimiento);
					$("#txtPropiedadesDireccion").val(obj.Propiedad[0].direccion);
					$("#txtPropiedadesNE").val(obj.Propiedad[0].ext);
					$("#txtPropiedadesNI").val(obj.Propiedad[0].int);
					$("#txtPropiedadesCol").val(obj.Propiedad[0].colonia);
					$("#txtPropiedadesCP").val(obj.Propiedad[0].cp);
					$("#txtPropiedadesCiudad").val(obj.Propiedad[0].ciudad);
					$("#txtPropiedadesEstado").val(obj.Propiedad[0].estado);
					$("#txtPropiedadesValorInicial").val(obj.Propiedad[0].valor_inicial);
					$("#txtPropiedadesMoneda").val(obj.Propiedad[0].tipo_moneda);
					$("#txtPropiedadesCambio").val(obj.Propiedad[0].cambio);
					$("#txtPropiedadesValorActual").val(obj.Propiedad[0].valor_actual);
					$("#txtPropiedadesAdquisicion").val(obj.Propiedad[0].adquisicion);
					$("#txtPropiedadesMontoInquilino").val(obj.Propiedad[0].monto_inquilino);
	 
	 				$("#areaRegCaracteriticas").css('visibility', 'visible');
	 				$("#areaArchivos").css('visibility', 'visible');

	 				$("#bar").width('0%');
			        $("#percent").html('0%');
			        $("#message").html('');
	 				
	 			}
	 		});
		}
		function caracteristicas(){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "listaCaracteristicas" },
	 			success: function(data){
	 				$("#slcPropiedadesCaracteristicas").append(data);
	 			}
	 		});
		}
		function cargaCaracteristicas(clave){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "buscaCaracteristicas", "clavePropiedad": clave},
	 			success: function(data){
	 				$('#listadoCaracteristicas tr:last').after(data);
	 			}
	 		});
		}
		function almacenaArchivos($cadena){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" : "almacenaArchivos", "cadena": $cadena },
	 			success: function(data){
	 				alert(data);
	 			}
	 		});
		}
		function muestraArchivos(clave){
				// alert("muestra");
				$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "muestraArchivos", "clave": clave },
	 			success: function(data){
	 				$('#listadoArchivos').html('<thead><tr><td>Tipo Documento</td><td>Descripci√≥n</td></tr></thead><tfoot><tr><td colspan="4"><div id="paging"><ul><li><a href="#"><span>Previous</span></a></li><li><a href="#" class="active"><span>1</span></a></li><li><a href="#"><span>2</span></a></li><li><a href="#"><span>3</span></a></li><li><a href="#"><span>4</span></a></li><li><a href="#"><span>5</span></a></li><li><a href="#"><span Next</span></a></li></ul></div></tr></tfoot>');
	 				$('#listadoArchivos tr:last').after(data);
	 				
	 			}
	 		});
		}
		function guardaRegistro(){

			$nombre =			$("#txtPropiedadesNombre").val();
			$tipo =				$("#slcPropiedadesTipo").val();
			$propietario =		$("#slcPropiedadesPropietario").val();
			$pagaM =			$("#slcPropiedadesMantenimiento").val();
			$direccion =		$("#txtPropiedadesDireccion").val();
			$nExt = 			$("#txtPropiedadesNE").val();
			$nInt = 			$("#txtPropiedadesNI").val();
			$colonia = 			$("#txtPropiedadesCodigo").val();
			$cp =				$("#txtPropiedadesCP").val();
			$ciudad =			$("#txtPropiedadesCiudad").val();
			$estado =			$("#txtPropiedadesEstado").val();
			$valorGInicial= 	$("#txtPropiedadesValorInicial").val();
			$moneda =			$("#txtPropiedadesMoneda").val();
			$cambio =			$("#txtPropiedadesCambio").val();
			$fechaAdquisicion=	$("#txtPropiedadesAdquisicion").val();
			$valorRActual =		$("#txtPropiedadesValorActual").val();
			$montoInquilino=	$("#txtPropiedadesMontoInquilino").val();

			$cadena = $nombre+")+("+$tipo+")+("+$propietario+")+("+$pagaM+")+("+$direccion+")+("+$nExt+")+("+$nInt+")+("+$colonia+")+("+$cp+")+("+$ciudad+")+("+$estado+")+("+$valorGInicial+")+("+$moneda+")+("+$cambio+")+("+$fechaAdquisicion+")+("+$valorRActual+")+("+$valorRActual+")+("+$montoInquilino;

			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "guardaRegistro", "cadena":$cadena},
	 			success: function(data){
	 				$("#areaRegCaracteriticas").css('visibility', 'visible');
	 				$("#areaArchivos").css('visibility', 'visible');
	 			}
	 		});
		}
		function limpiaCampos(){
			$("#claveNombreFile").val('');
			$("#txtPropiedadesClave").val('');
			$("#txtPropiedadesNombre").val('');
			$("#txtPropiedadesMontoInquilino").val('');
			$("#slcPropiedadesTipo").val('-1');
			$("#slcPropiedadesPropietario").val('-1');
			$("#slcPropiedadesMantenimiento").val('1');
			$("#txtPropiedadesDireccion").val('');
			$("#txtPropiedadesNE").val('');
			$("#txtPropiedadesNI").val('');
			$("#txtPropiedadesCol").val('');
			$("#txtPropiedadesCP").val('');
			$("#txtPropiedadesCiudad").val('');
			$("#txtPropiedadesEstado").val('-1');
			$("#txtPropiedadesValorInicial").val('');
			$("#txtPropiedadesMoneda").val('MXN');
			$("#txtPropiedadesCambio").val('');
			$("#txtPropiedadesValorActual").val('');
			$("#txtPropiedadesAdquisicion").val('');
			$("#txtPropiedadesMontoInquilino").val('');

			$("#areaRegCaracteriticas").css('visibility', 'hidden');
			$("#areaArchivos").css('visibility', 'hidden');

			$("#bar").width('0%');
			$("#percent").html('0%');
			$("#message").html('');
			menuDos();
		}
		function cuentaMenus(){
		$cuentaMenus = 0;
		$("#submenu .subli").each(function(){
			$cuentaMenus ++;
		});
		return $cuentaMenus;

		}
		function anchoVentana(){
			$anchoVentana = $( window ).width();
			return $anchoVentana;
		}
		function menuUno(){
			$("#menuUno").removeClass('inactivo').addClass('activo');
			$("#menuDos").removeClass('activo').addClass('inactivo');
			$("#menuTres").removeClass('activo').addClass('inactivo');
			$(".areaTabla").show();
			$("#areaArchivos").hide();
			$("#areaFormulario").hide();
			$("#areaRegCaracteriticas").hide();
		}
		function menuDos(){
			$("#menuUno").removeClass('activo').addClass('inactivo');
			$("#menuDos").removeClass('inactivo').addClass('activo');
			$("#menuTres").removeClass('activo').addClass('inactivo');
			$(".areaTabla").hide();
			$("#areaArchivos").hide();
			$("#areaFormulario").show();
			$("#areaRegCaracteriticas").hide();
		}
		function menuTres(){
			$("#menuUno").removeClass('activo').addClass('inactivo');
			$("#menuDos").removeClass('activo').addClass('inactivo');
			$("#menuTres").removeClass('inactivo').addClass('activo');
			$(".areaTabla").hide();
			$("#areaArchivos").show();
			$("#areaFormulario").hide();
			$("#areaRegCaracteriticas").show();
		}
	 </script>
	 <style>
	 	body{
			margin: 0px;
			padding: 0px;
		}
		form { display: block; margin: 20px auto; background: #eee; border-radius: 10px; padding: 15px }
		#progress { position:relative; width:400px; border: 1px solid #ddd; padding: 1px; border-radius: 3px; }
		#bar { background-color: #B4F5B4; width:0%; height:20px; border-radius: 3px; }
		#percent { position:absolute; display:inline-block; top:3px; left:48%; }
		
		
		#divMain{
			width: 100%;
			height: 100%;
		}
		#submenu{
			position: relative;
			width: 100%;
			height: 60px;
			border:0px solid;
		}
		#submenu ul{
			list-style: none;
			padding: 0px;
			height: 100%;
			margin: 0px;
		}
		#submenu li{
			float: left;
			/*width: 100%;*/
			height: 100%;
			
		}
		#submenu .izq{
			border-right: 1px solid #555555;
		}
		#submenu .der{
			
		}
		.lblmenu {
		    position: relative;
		}
		.subli{
			padding-top: 10px;
		}
		.activo{
			background-color: #ffffff;
			border-bottom: 0px solid #555555;
		}
		.inactivo{
			background-color: #eeeeee;
			border-bottom: 2px solid #555555;
		}
		.inactivo:hover{
			background-color: #cccccc;
			border-bottom: 2px solid #555555;
		}
		.subli div{
			width: auto;
			padding-left: 15px;

		}
		.subli i:before {
		    content: "\f005";
		    font-family: FontAwesome;
		    font-style: normal;
		    font-weight: normal;
		    text-decoration: inherit;
		/*--adjust as necessary--*/
		    color: #000;
		    font-size: 25px;
		    padding-right: 0.5em;
		    position: absolute;
		    top: 10px;
		    left: 30px;
		    /*bottom: 0px;*/
		    
		}
		.subli i{
			padding-top: 13px;
			padding-left: 55px;
			padding-bottom: 15px;

		}
		#txtPropiedadesNombre{
			width: 250px;
		}
		#txtPropiedadesDireccion{
			width: 200px;
		}
		#txtPropiedadesNE, #txtPropiedadesNI, #txtPropiedadesCP{
			width: 50px;
		}
		#txtPropiedadesCol{
			width: 170px;
		}
		#txtPropiedadesValorInicial, #txtPropiedadesCambio, #txtPropiedadesValorActual, #txtPropiedadesMontoInquilino{
			width: 80px;
		}
	</style>
	</style>
</head>
<body>
<div id="divMain">
	<div id="submenu">
		<ul>
			<li id="menuUno" onclick="menuUno()" class="activo subli izq"><i class="fa fa-book icon-large"><div>Menu Uno</div></i></li>
			<li id="menuDos" onclick="menuDos()" class="inactivo subli izq"><i class="fa fa-book icon-large"><div>dos</div></i></li>
			<li id="menuTres" onclick="menuTres()" class="inactivo subli der"><i class="fa fa-book icon-large"><div>tres</div></i></li>

		</ul>
	</div>
	<div class="cuerpo">
		<!-- <br>
		<h1>Propiedades</h1> -->

		<div id="listadoPropiedades" class="areaTabla datagrid">
			<table border="1" >
				<thead>
				<tr>
					<th width="120px">Fecha de Registro</th><th width="150px">Propiedad</th><th width="150px">Tipo de Propiedad</th><th width="150px">Propietario</th>
				</tr>
				</thead>
				<tfoot>
					<tr><td colspan="4"><div id="paging"><ul><li><a href="#"><span>Previous</span></a></li><li><a href="#" class="active"><span>1</span></a></li><li><a href="#"><span>2</span></a></li><li><a href="#"><span>3</span></a></li><li><a href="#"><span>4</span></a></li><li><a href="#"><span>5</span></a></li><li><a href="#"><span>Next</span></a></li></ul></div></tr>
				</tfoot>
				
			<!-- </table> -->
			<!-- <div class="datagrid" style="overflow:auto; height:200px;"> -->
				<!-- <table border="1" id="listadoPropiedades"> -->
					<tbody>
					<tr>
						<td width="120px"></td>
						<td width="150px"></td>
						<td width="150px"></td>
						<td width="150px"></td>
					</tr>
					</tbody>
				</table>
			<!-- </div> -->
				
					

			<input type="button" value="Nuevo Registro" onclick="limpiaCampos()">
			

		</div>

			

		<!-- <br><br> -->
		<div id="areaFormulario" >
			<table border ="0">
				<tr>
					<td colspan="3"><label>Tipo Propiedad: </label><select id="slcPropiedadesTipo"><option value="-1">-Tipo de Propiedad-</option></select></td><td colspan="3"><label>Propietario: </label><select id="slcPropiedadesPropietario"><option value="-1">-Propietario-</option></select></td>
				</tr>
				<tr>
					<td colspan="6"><label>Nombre Propiedad: </label><input type="text" id="txtPropiedadesNombre"></td>
				</tr>
				<tr>
					<td colspan="6"><label>Direccion: </label><input type="text" id="txtPropiedadesDireccion"> 
			<label>Numero Ext: </label><input type="text" id="txtPropiedadesNE"><label> Int: </label><input type="text" id="txtPropiedadesNI"></td>
				</tr>
				<tr>
					<td colspan="6"><label>Colonia: </label><input type="text" id="txtPropiedadesCol"><label>CP: </label><input type="text" id="txtPropiedadesCP"> <label>Ciudad: </label><input type="text" id="txtPropiedadesCiudad"></td>
				</tr>
				<tr>
					<td colspan="6"><label>Estado: </label><select id="txtPropiedadesEstado"><option value="-1">Selecciona un Estado</option></select></td>
				</tr>
				<tr>
					<td colspan="6"><label>Paga Mantenimiento: </label><select id="slcPropiedadesMantenimiento"><option value="1">SI</option><option value="0">NO</option></select></td>
				</tr>
				<tr>
					<td colspan="6"><label>Fecha Adquisici√≥n: </label><input type="date" id="txtPropiedadesAdquisicion"></td>
				</tr>
				<tr>
					<td colspan="2"><label>Valor Inicial $</label><input type="text" id="txtPropiedadesValorInicial"> </td><td colspan="2"><label>Moneda: </label><select id="txtPropiedadesMoneda"><option value="MXN">MXN</option><option value="USD">USD</option></select></td><td colspan="2"><label>Tipo de Cambio: </label><input type="text" id="txtPropiedadesCambio"></td>
				</tr>
				<tr>
					<td colspan="3"><label>Valor Real Actual: </label><input type="text" id="txtPropiedadesValorActual"> </td><td colspan="3"><label>Monto por Inquilino Actual: </label><input type="text" id="txtPropiedadesMontoInquilino"></td>
				</tr>
			</table>
			<!-- Clave: --> <input type="hidden" id="txtPropiedadesClave"> <br>
			
			<input type="button" value="Guardar Registro" onclick="guardaRegistro()">

		</div>
			
		<div id="areaRegCaracteriticas" >
			<h3>Registro de Caracteristicas</h3>

			Caracteristica: <select id="slcPropiedadesCaracteristicas"><option>Seleccione una Caracteristica</option></select>    Valor:<input type="text" id="txtPropiedadesCaracteristicaValor"> <br>
			<input type="button" value="Agregar" id="btnAgregaCaract">
			<br>
			<table id="listadoCaracteristicas" border="1">
				<tr>
					<td>Caracteristica</td><td>Valor</td>
				</tr>
			</table>
		</div>
		<div id="areaArchivos" >
			<form id="myForm" action="../../../archivos/control/upload.php" method="post" enctype="multipart/form-data">
				
				<select id="tipoDocumentoFile" name="tipoDocumentoFile"><option value="doc1">Documento 1</option><option value="doc2">Documento 2</option></select>
				<br><br>
				<input type="file" size="60" name="myfile" id="myfile">
				<br><br>
				Descripci√≥n:<br> <textarea id="descripcionFile"></textarea>
				<br><br>
				<input type="submit" value="Cargar Archivo">
				
				<input type="hidden" value="0" name="claveNombreFile" id="claveNombreFile">
				<input type="hidden" value="propiedades" name="subdir">
				
			 </form>
			 
			 <br>
			  <div id="progress">
			        <div id="bar"></div>
			        <div id="percent">0%</div >
			</div>
			<br/>
			 
			<div id="message"></div>
			 <br>
			<table border="1" id="listadoArchivos">
				<tr>
					<td>Tipo Documento</td><td>Descripci√≥n</td>
				</tr>
			</table>
		</div>
	</div>
</div>
		
	
</body>
</html>