<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>
	<title></title>
	 <script type="text/javascript" src="/kalilhel/js/jquery-1.10.2.min.js"></script>
	 <script type="text/javascript" src="/kalilhel/js/jquery.form.js"></script>
	 <script type="text/javascript">
	 	$cadena=""; 
		$(document).ready(function(){
			// inicio carga de archivos
			var options = { 
			    beforeSend: function() 
			    {
			        $("#progress").show();
			        //clear everything
			        $("#bar").width('0%');
			        $("#message").html("");
			        $("#percent").html("0%");
			    },
			    uploadProgress: function(event, position, total, percentComplete) 
			    {
			        $("#bar").width(percentComplete+'%');
			        $("#percent").html(percentComplete+'%');
			 
			    },
			    success: function() 
			    {
			        $("#bar").width('100%');
			        $("#percent").html('100%');
			 
			    },
			    complete: function(response) 
			    {
			        $("#message").html("<font color='green'>"+response.responseText+"</font>");
			        $clave_cliente = $("#claveNombreFile").val();
			        $tipo_documento = $("#tipoDocumentoFile").val();
			        $archivo = $("#myfile").val();
			        $descripcion = $("#descripcionFile").val();
			        $explode= $archivo.split(".");
					$extension=$explode.pop();
					$nombre_archivo = $tipo_documento+"_"+$clave_cliente+"."+$extension;
			        $cadena = $clave_cliente+"///"+$tipo_documento+"///"+$archivo+"///"+$descripcion+"///";

			        almacenaArchivos($cadena);
			        // listadoArchivos($clave_cliente);
			        $("#listadoArchivos #tr"+$tipo_documento).remove();
			        $('#listadoArchivos tr:last').after('<tr id="tr'+$tipo_documento+'"><td>'+$tipo_documento+'</td><td>'+$descripcion+'</td><td><a href="../../../uploads/contactos/'+$nombre_archivo+'" target="_BLANK">Abrir Archivo</a></td></tr>');
			    },
			    error: function()
			    {
			        $("#message").html("<font color='red'> ERROR: unable to upload files</font>");
			 
			    }
			}; 
			$("#listadoClientes").on('click','td',function(){
				$("#listadoClientes td").css('background-color','#ffffff');
				$(this).parent('tr').children('td').css('background-color','#e8f5bf');
			});
 
    		$("#myForm").ajaxForm(options);
			// fin carga de archivos

			$("#SlcTipoCliente").change(function(){
				$tipo = $("#SlcTipoCliente").val();

				$(":input[type='text']").val('');
				$("#listadoArchivos").html('<tr><td>Tipo Documento</td><td>Descripción</td></tr>');
				try{
					$("#claveNombreFile").val(obj.Contacto[$tipo].clave);
	 				$("#txtContactoClave").val(obj.Contacto[$tipo].clave);
					$("#txtContactoNombre").val(obj.Contacto[$tipo].nombre);
	 				$("#txtContactoEmail").val(obj.Contacto[$tipo].email);
	 				$("#txtContactoTelefono").val(obj.Contacto[$tipo].telefonoCasa);
	 				$("#txtContactoRfc").val(obj.Contacto[$tipo].rfc);
	 				$("#txtContactoDireccion").val(obj.Contacto[$tipo].direccion);
	 				$("#txtContactoNE").val(obj.Contacto[$tipo].ext);
	 				$("#txtContactoNI").val(obj.Contacto[$tipo].int);
	 				$("#txtContactoCol").val(obj.Contacto[$tipo].colonia);
	 				$("#txtContactoCP").val(obj.Contacto[$tipo].cp);
	 				$("#txtContactoCiudad").val(obj.Contacto[$tipo].ciudad);
	 				$("#SlcContactoEstado").val(obj.Contacto[$tipo].estado);
	 				muestraArchivos(obj.Contacto[$tipo].clave);
				}
				catch(err){}
					
			});

			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "cargaContacto" },
	 			success: function(data){
	 				// alert(data);
	 				obj = JSON.parse(data);
	 				$v1=0;
	 				while(obj.Contacto[$v1]){
	 					agregaFilaContactos(obj.Contacto[$v1]);
						// alert(obj.Contacto[$v1].nombre);
						$v1++;
	 				}
	 			}
	 		});
	 		$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "cargaEstados" },
	 			success: function(data){
	 				$("#SlcContactoEstado").append(data);
	 				
	 			}
	 		});
	 		$("#listadoClientes").on("dblclick", "tr", function(){
	 			alert("doble");
	 		});
	 		$("#SlcTipoTelefono").change(function(){
	 			
	 			switch($(this).val()){
	 				case 'telHome': $("#txtContactoTelefono").val($("#txtContactoTelefono").attr('telcasa')); break;
	 				case 'telCel': $("#txtContactoTelefono").val($("#txtContactoTelefono").attr('telCel')); break;
	 				case 'telJob': $("#txtContactoTelefono").val($("#txtContactoTelefono").attr('telJob')); break;
	 			}
	 		});
		});
		function agregaFilaContactos(reg){
		$('#listadoClientes tr:last').after('<tr onclick="muestraContacto('+reg.clave+');muestraArchivos('+reg.clave+');"><td>'+reg.nombre+'</td><td>'+reg.email+'</td></tr>');
		}
		function muestraContacto(clave){
				
				$("#listadoArchivos").html('<tr><td>Tipo Documento</td><td>Descripción</td></tr>');
				$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "recuperaUnContacto", "clave": clave },
	 			success: function(data){
	 				// alert(data);
	 				obj = JSON.parse(data);
	 				// alert(obj.Contacto[1].rfc);
	 				$("#SlcTipoCliente").val('1');
	 				$("#claveNombreFile").val(obj.Contacto[1].clave);
	 				$("#txtContactoClave").val(obj.Contacto[1].clave);
	 				$("#txtContactoNombre").val(obj.Contacto[1].nombre);
	 				$("#txtContactoEmail").val(obj.Contacto[1].email);
	 				$("#txtContactoTelefono").val(obj.Contacto[1].telefonoCasa);
	 				$("#txtContactoTelefono").attr('telcasa',obj.Contacto[1].telefonoCasa);
	 				$("#txtContactoTelefono").attr('telcel',obj.Contacto[1].telefonoCel);
	 				$("#txtContactoTelefono").attr('teljob',obj.Contacto[1].telefonoOficina);
	 				
	 				$("#txtContactoRfc").val(obj.Contacto[1].rfc);
	 				$("#txtContactoDireccion").val(obj.Contacto[1].direccion);
	 				$("#txtContactoNE").val(obj.Contacto[1].ext);
	 				$("#txtContactoNI").val(obj.Contacto[1].int);
	 				$("#txtContactoCol").val(obj.Contacto[1].colonia);
	 				$("#txtContactoCP").val(obj.Contacto[1].cp);
	 				$("#txtContactoCiudad").val(obj.Contacto[1].ciudad);
	 				$("#SlcContactoEstado").val(obj.Contacto[1].estado);
	 				$("#divArchivos").show();
	 			}
	 		});
				
		}
		function muestraArchivos(clave){
				// alert("muestra");
				$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" :  "muestraArchivos", "clave": clave },
	 			success: function(data){

	 				$('#listadoArchivos tr:last').after(data);
	 					
	 			}
	 		});
		}
		function almacenaArchivos($cadena){
			$.ajax({
	 			type: "POST",
	 			url: "../control/control.php",
	 			data: { "funcion" : "almacenaArchivos", "cadena": $cadena },
	 			success: function(data){
	 				alert(data);
	 				
	 				
	 			}
	 		});
		}



		function cambiaInfoContacto(){
			// $("#listadoArchivos tr:#trife").remove();
		}
	 </script>
	 <style>
		form { display: block; margin: 20px auto; background: #eee; border-radius: 10px; padding: 15px }
		#progress { position:relative; width:400px; border: 1px solid #ddd; padding: 1px; border-radius: 3px; }
		#bar { background-color: #B4F5B4; width:0%; height:20px; border-radius: 3px; }
		#percent { position:absolute; display:inline-block; top:3px; left:48%; }
	</style>
	
</head>
<body>


 

<br><br>
<table border="1" id="listadoClientes">
	<tr>
		<th>Nombre</th>
		<th>Email</th>
		
	</tr>
</table>
<br>
Tipo de Cliente: <select id="SlcTipoCliente" change="cambiaInfoContacto"><option value="1">Arrendatario</option><option value="2">Contacto</option><option value="3">Fiador</option> </select><br>
Clave: <input type="text" id="txtContactoClave" disabled> <br><!-- autonumerico -->
Nombre: <input type="text" id="txtContactoNombre" disabled><br>
Email: <input type="text" id="txtContactoEmail" disabled><br>
Telefono: <input type="text" telcasa="" telcel="" teljob="" id="txtContactoTelefono" disabled> <select id="SlcTipoTelefono"><option value="telHome">Casa</option><option value="telCel">Celular</option><option value="telJob">Trabajo</option> </select><br>
RFC: <input type="text" id="txtContactoRfc" disabled><br>
Dirección: <input type="text" id="txtContactoDireccion" disabled> Numero Ext: <input type="text" id="txtContactoNE" disabled> Int: <input type="text" id="txtContactoNI" disabled><br>
Colonia <input type="text" id="txtContactoCol" disabled><br>
Codigo Postal: <input type="text" id="txtContactoCP" disabled><br>
Ciudad / Municipio: <input type="text" id="txtContactoCiudad" disabled>
Estado: <select id="SlcContactoEstado"><option>Selecciona un Estado</option> </select>
<!-- <br>
<h5>Datos Facturacion</h5>
Razon Social: <input type="text" id="txtFacturacionRS" disabled><br>
Dirección Fiscal: <input type="text" id="txtFacturacionDF" disabled>
Numero Ext: <input type="text" id="txtFacturacionNE" disabled> Int: <input type="text" id="txtFacturacionNI" disabled><br>
Colonia: <input type="text" id="txtFacturacionColonia" disabled><br>
Codigo Postal: <input type="text" id="txtFacturacionCP" disabled><br>
Municipio / Delegación: <input type="text" id="txtFacturacionMunicipio" disabled><br>
Ciudad: <input type="text" id="txtFacturacionCiudad" disabled>
Estado: <select id="SlcFacturacionEstado"><option value="1">Distrito Federal</option><option value="2">Aguascalientes</option> </select>
<br> -->
<!-- <input type="button" value="Guardar"> <br> -->
<!-- <input type="button" value="Eliminar"><br> -->
<!-- <input type="button" value="Limpiar"><br> -->
<!-- <input type="button" value="Agregar Documentos"> -->
<br>
<div id="divArchivos" hidden>
	<form id="myForm" action="../../../archivos/control/upload.php" method="post" enctype="multipart/form-data">
		
		<select id="tipoDocumentoFile" name="tipoDocumentoFile"><option value="ife">IFE</option><option value="comprDomicilio">Comprobante de Domicilio</option></select>
		<br><br>
		<input type="file" size="60" name="myfile" id="myfile">
		<br><br>
		Descripción:<br> <textarea id="descripcionFile"></textarea>
		<br><br>
		<input type="submit" value="Cargar Archivo">
		
		<input type="hidden" value="0" name="claveNombreFile" id="claveNombreFile">
		<input type="hidden" value="contactos" name="subdir">
		
	 </form>
	 
	 <br>
	  <div id="progress">
	        <div id="bar"></div>
	        <div id="percent">0%</div >
	</div>
	<br/>
	 
	<div id="message"></div>
	 <br>
	<table border="1" id="listadoArchivos">
		<tr>
			<td>Tipo Documento</td><td>Descripción</td>
		</tr>
	</table>
</div>
	
</body>
</html>