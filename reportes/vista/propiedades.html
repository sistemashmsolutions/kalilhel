<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>
	<title></title>
	<script type="text/javascript" src="../../js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript">
	$(document).ready(function(){
		$.ajax({
 			type: "POST",
 			url: "../control/control.php",
 			data: { "funcion" :  "reportePropiedad" },
 			success: function(data){
 				// alert(data);
 				listaTabla(data);
 			}
 		});
		
	});
	function filtra(){
		
		$txtFiltroPropiedad = $("#txtFiltroPropiedad").val();
		$txtFiltroPropietario = $("#txtFiltroPropietario").val();
		
			$.ajax({
 			type: "POST",
 			url: "../control/control.php",
 			data: { "funcion" :  "filtraTablaPropiedad", "txtFiltroPropiedad": $txtFiltroPropiedad, "txtFiltroPropietario": $txtFiltroPropietario},
 			success: function(data){
 				$("#tablaReporte").html('<tr><th>Propiedad</th><th>Propietario</th><th>Costo de Adquisición</th><th>% Rend. Mensual</th><th>% Rend. Anual</th><th>Generado al día</th><th>Costo por Recuperar</th></tr>');
 				listaTabla(data);
 			}
 		});
 			
	}
	function listaTabla(data){
		obj = JSON.parse(data);

			$filas = "";
			$.each( obj.Reporte, function(key) {

				$inicial = obj.Reporte[key].valor_inicial;
				if(isNaN(obj.Reporte[key].valor_inicial) || obj.Reporte[key].valor_inicial==null){$inicial = 0;}

				$generado = obj.Reporte[key].generado;
				if(isNaN(obj.Reporte[key].generado) || obj.Reporte[key].generado==null){$generado = '';}

				$renMensual = ((parseFloat(obj.Reporte[key].monto)/parseFloat(obj.Reporte[key].valor_inicial))*100).toFixed(2);
				

				$rendAnual = ($renMensual*12).toFixed(2);

				if(isNaN($renMensual) || $renMensual==null){ $renMensual = ''; $rendAnual=''; }

				$recuperado = $inicial - $generado;

				$filas += "<tr id='fila_"+obj.Reporte[key].clave+"'>";
				$filas += "<td>"+obj.Reporte[key].nombre+"</td>";
				$filas += "<td>"+obj.Reporte[key].propietario+"</td>";
				$filas += "<td>"+$inicial+"</td>";
				$filas += "<td>"+$renMensual+"</td>";
				$filas += "<td>"+$rendAnual+"</td>";
				$filas += "<td>"+$generado+"</td>";
				$filas += "<td>"+$recuperado+"</td>";
				$filas += "</tr>";
				
		});
		$("#tablaReporte").append($filas);
	}
	</script>
</head>
<body>
<table>
	<tr>
		<td>Filtro:</td>
	</tr>
	<tr>
		<td>Propiedad: </td><td><input type="text" id="txtFiltroPropiedad" onkeyup="filtra()"></td><td>Propietario:</td><td><input type="text" id="txtFiltroPropietario" onkeyup="filtra()"></td>
	</tr>
</table>

 <br>
<table border="1" id="tablaReporte">
	<tr>
		<th>Propiedad</th><th>Propietario</th><th>Costo de Adquisición</th><th>% Rend. Mensual</th><th>% Rend. Anual</th><th>Generado al día</th><th>Costo por Recuperar</th>
	</tr>
</table>
</body>
</html>