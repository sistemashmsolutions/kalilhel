<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>
	<title></title>
	<link rel="stylesheet" type="text/css" href="/kalilhel/css/general.css">
	<link rel="stylesheet" type="text/css" href="/kalilhel/css/tabla.css">
	<script type="text/javascript" src="/kalilhel/js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="/kalilhel/js/jquery.form.js"></script>
	<script type="text/javascript">
	$(document).ready(function(){
		$.ajax({
 			type: "POST",
 			url: "../control/control.php",
 			data: { "funcion" :  "reporteRentabilidad" },
 			success: function(data){
 				// alert(data);
 				listaTabla(data);
 			}
 		});
		
	});
	function filtra(){
		$txtFiltroCliente = $("#txtFiltroCliente").val();
		$txtFiltroEmpresa = $("#txtFiltroEmpresa").val();
		
			$.ajax({
 			type: "POST",
 			url: "../control/control.php",
 			data: { "funcion" :  "filtraTablaRentabilidad", "txtFiltroCliente": $txtFiltroCliente, "txtFiltroEmpresa": $txtFiltroEmpresa},
 			success: function(data){
 				$("#tablaReporte").html('<tr><th># CLIENTE</th><th>NOMBRE</th><th>EMPRESA</th><th>DESCRIPCION</th><th> INVERSION </th><th> MONEDA </th><th>FECHA DE COMPRA</th><th> INGRESOS GENERADOS</th><th> INVERSIÓN RECUPERADA </th><th> PENDIENTE POR RECUPERAR </th><th>RENTABILIDAD</th></tr>');
 				listaTabla(data);
 			}
 		});
	}
	function listaTabla(data){
		obj = JSON.parse(data);
		$filas = "";
		$.each( obj.Reporte, function(key) {
			// $generado = (parseInt(obj.Reporte[key].rentas)+parseInt(obj.Reporte[key].valor_vendido)-parseInt(obj.Reporte[key].valor_inicial));
			// $porsGenerado = (($generado/obj.Reporte[key].valor_inicial)*100).toFixed(3);
			$pendiente = parseFloat(obj.Reporte[key].valor_inicial) - parseFloat(obj.Reporte[key].recuperado);
			$rentabilidad = (((parseFloat(obj.Reporte[key].valorGeneradoInicial) + parseFloat(obj.Reporte[key].ingresos))/parseFloat(obj.Reporte[key].adquisicion))*100).toFixed(2);


			$ingresos = obj.Reporte[key].ingresos;
			if(isNaN(obj.Reporte[key].ingresos) || obj.Reporte[key].ingresos==null){$ingresos = '';}

			$recuperado = obj.Reporte[key].recuperado;
			if(isNaN(obj.Reporte[key].recuperado) || obj.Reporte[key].recuperado==null){$recuperado = '';}

			if(isNaN($pendiente) || $pendiente==null){$pendiente = '';}

			if(isNaN($rentabilidad) || $rentabilidad==null){$rentabilidad = '';}

			$filas += "<tr id='fila_"+obj.Reporte[key].rentaID+"'>";
			$filas += "<td>"+obj.Reporte[key].clave+"</td>";
			$filas += "<td>"+obj.Reporte[key].nombre+"</td>";
			$filas += "<td>"+obj.Reporte[key].empresa+"</td>";
			$filas += "<td>"+obj.Reporte[key].descripcion+"</td>";
			$filas += "<td>"+obj.Reporte[key].valor_inicial+"</td>";
			$filas += "<td>"+obj.Reporte[key].tipo_moneda+"</td>";
			$filas += "<td>"+obj.Reporte[key].adquisicion+"</td>";
			$filas += "<td>"+$ingresos+"</td>";
			$filas += "<td>"+$recuperado+"</td>";
			$filas += "<td>"+$pendiente+"</td>";
			$filas += "<td>"+$rentabilidad+"</td>";

			$filas += "</tr>";
			 // propiedades.valor_inicial, propiedades.valor_vendido, SUM(cortes.`monto`) as rentas
		});
		$("#tablaReporte").append($filas);
	}
	</script>
</head>
<body>
<table>
	<tr>
		<td>Filtro:</td>
	</tr>
	<tr>
		<td>Cliente: </td><td><input type="text" id="txtFiltroCliente" onkeyup="filtra()"></td><td>Empresa:</td><td><input type="text" id="txtFiltroEmpresa" onkeyup="filtra()"></td>
	</tr>
</table>
<br>
<div class="cuerpo">
	<div class="datagrid">
		<table border="1" id="tablaReporte">
			<thead>
				<tr>
					<th># CLIENTE</th><th>NOMBRE</th><th>EMPRESA</th><th>DESCRIPCION</th><th> INVERSION </th><th> MONEDA </th><th>FECHA DE COMPRA</th><th> INGRESOS GENERADOS</th><th> INVERSIÓN RECUPERADA </th><th> PENDIENTE POR RECUPERAR </th><th>RENTABILIDAD</th>
				</tr>
			</thead>
			<tfoot>
				<tr><td colspan="11"><div id="paging">
					<!-- <ul>
						<li><a href="#" onclick="pagPrev()"><span>Previous</span></a></li>
						<li id="paging1"><a onclick="limpiaTabla(0)" class="active"><span>1</span></a></li>
						<li><a href="#" onclick="pagSig()"><span>Next</span></a></li>
					</ul> -->
				</div></td></tr>
			</tfoot>
				<tbody>
				<tr>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
				</tr>
			</tbody>
				
		</table>
	</div>
</div>
</body>
</html>